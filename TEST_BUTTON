#define PIN_BTN 5 //пин кнопки
#define PIN_WHITE 13 //пин для белой ленты 
int leds[] = { 12, 14, 27, 26 }; // пины светодиодов
int state = 0;

//для энкодера 
#define CLK 23
#define DT 22
#define SW 21

#include "GyverEncoder.h" //библиотека энкодера 
Encoder enc1(CLK, DT, SW);
int value = 0; // положение энкодера 


bool flag = false;
uint32_t btnTimer = 0;

void setup() {
  Serial.begin(9600);

  enc1.setType(TYPE2);
  enc1.setFastTimeout(40);

  pinMode(PIN_BTN, INPUT_PULLUP);

  for (int i = 0; i < 4; i++)
    pinMode(leds[i], OUTPUT);


}


void loop() {

  bool btnState = digitalRead(PIN_BTN);
  if (btnState && !flag && millis() - btnTimer > 100) {
    flag = true;
    btnTimer = millis();
    digitalWrite(leds[state], LOW);
    state++;
    if (state >= 4) state = 0;
    Serial.print(state);
    Serial.print(" ");
    Serial.println("press");
  }

  if (!btnState && flag && millis() - btnTimer > 500) {
    flag = false;
    btnTimer = millis();
    //Serial.println("release");
  }

  digitalWrite(leds[state], HIGH);

  if (state == 0){
    analogWrite(13, 10);
  }

  if (state == 1) {
    enc1.tick();

    if (enc1.isRight()) value++;  // если был поворот направо, увеличиваем на 1
    if (enc1.isLeft()) value--;   // если был поворот налево, уменьшаем на 1

    if (enc1.isFastR()) value += 10;  // если был быстрый поворот направо, увеличиваем на 10
    if (enc1.isFastL()) value -= 10;  // если был быстрый поворот налево, уменьшаем на 10
    // if (enc1.isTurn()) {              // если был совершён поворот (индикатор поворота в любую сторону)
    //   Serial.println(value);          // выводим значение при повороте
    // }
    if (value >= 255) value = 254;
    if (value <= 0) value = 1;
    analogWrite(13, value);
  }
  
  if (state == 2){
    analogWrite(13, 255);
    //max
  }

  if (state == 3){
    analogWrite(13, 0);
    //rgb
  }
}
